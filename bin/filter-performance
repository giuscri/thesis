#!/usr/bin/env python

from argparse import ArgumentParser
import sys, os, pickle
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))
from datasets import mnist
from models import load_from_file, accuracy
from attacks import adversarial_score

argument_parser = ArgumentParser()
argument_parser.add_argument("--model", nargs="+", dest="model_paths",
                             required=True, help="path to model to use")
argument_parser.add_argument("--eta", type=float, default=0.1,
                             help="(default: 0.1) value of eta to use for FGS")

args = argument_parser.parse_args()

_, _, X_test, y_test = mnist()

for model_path in args.model_paths:
    model = load_from_file(model_path)

    mnist_accuracy = accuracy(model, X_test, y_test)
    mnist_adversarial_score = adversarial_score(model, X_test, y_test, eta=0.1)

    print(f"## {model.name}: accuracy {mnist_accuracy}, adversarial_score {mnist_adversarial_score}")
