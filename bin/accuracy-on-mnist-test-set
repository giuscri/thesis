#!/usr/bin/env python

import os, sys, argparse
from glob import glob

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))
from datasets import mnist
from models import train, accuracy, load_from_file

argument_parser = argparse.ArgumentParser()
argument_parser.add_argument('--model', nargs="+", dest="model_paths",
                             help="models to test the accuracy of")

args = argument_parser.parse_args()

if not args.model_paths:
    model_paths = ["model/fc-100-100-10"]
    model_paths.extend(glob("model/reconstruction/*"))
    model_paths.extend(glob("model/retraining/*"))
else:
    model_paths = args.model_paths

_, _, X_test, y_test = mnist()
for path in model_paths:
    if not os.path.exists(path):
        continue

    model = load_from_file(path)
    test_set_accuracy = accuracy(model, X_test, y_test)
    print(f"{path} -> {test_set_accuracy}")
